---
name: Table
route: /Table
menu: Table / 表格渲染
---

import { Playground, PropsTable } from 'docz'
import { State, Toggle } from 'react-powerplug'
import { ShowModal } from '../modal';
import { Table, DescHelper } from './';
import { DropdownMenu } from '../selector';
import KeyMapper from './key-mapper.mdx';
import { records, keyMapper, keyMapperFixed } from './table-mock-data';

# Table

## 通用表格渲染

完美表格很难，但 uke-table 拥有以下特点

- 声明式逻辑处理
- 自动计算 cell 的宽度
- 固定头部
- 固定指定的列
- 可对已有元素进行排列
- 表头嵌入选择器和过滤器

<PropsTable of={Table} />

## 常规使用

- keyMapper 需要显示的数据的字段映射集合
- records   数据源

对应关系

```js
// key 对应 records 的所有项的 [key], 以下例子对应 username
const keyMapper = [
  {
    key: 'username'
  }
]
const records = [
  {
    username: 'alex',
  }
  {
    username: 'blex',
  }
  {
    username: 'clex',
  }
]
```

> 可以使用自定义的 filter 或者内置 filter，下面章节有详细描述。

<Playground>
  {
    () => {
      return (
        <State initial={{
          keyMapper: [...keyMapper],
          records: [...records]
        }}>
          {
            ({ state, setState }) => {
              let table;

              return (
                <div>
                  <Table
                    keyMapper={state.keyMapper}
                    ref={e => table = e}
                    rowKey={record => record.id}
                    needCount
                    onChange={(emitVal, config) => {
                      console.log(emitVal, config)
                    }}
                    records={state.records} />
                </div>
              )
            }
          }
        </State>
      )
    }
  }
</Playground>

## 可选的 row

- whenCheckAction 为选中后出现的元素

<Playground>
  {
    () => {
      return (
        <State initial={{
          keyMapper: [...keyMapper],
          records: [...records]
        }}>
          {
            ({ state, setState }) => {
              let table;

              return (
                <div>
                  <Table
                    keyMapper={state.keyMapper}
                    ref={e => table = e}
                    whenCheckAction={checkedItems => (
                      <span className="btn theme mu10" onClick={e => table.clearCheckeds()}>
                        清除所有的以选中项
                      </span>
                    )}
                    rowKey={record => record.id}
                    needCheck
                    needCount
                    onChange={(emitVal, config) => {
                      console.log(emitVal, config)
                    }}
                    records={state.records} />
                </div>
              )
            }
          }
        </State>
      )
    }
  }
</Playground>

## 固定表头 && 固定左右列

- 固定表头，只需要添加 height
- 固定列，为 keyMapper 添加 fixed: 'left'[, 'right'] 配置，并且要注意，从最左边开始添加 left，或者最右开始添加 right

```js
const keyMapper = [
  {
    ...config,
    fixed: 'left'
  },
  ...mappers,
  {
    ...config,
    fixed: 'right'
  }
]
```

<Playground>
  {
    () => {
      return (
        <State initial={{
          keyMapper: [...keyMapperFixed],
          records: [],
          show: false
        }}>
          {
            ({ state, setState }) => {
              let table;

              return (
                <div>
                  <div className="mb10">
                    <span className="btn red mr10" onClick={e => {
                      setState(({ keyMapper }) => {
                        let nextKeyMapper = [...keyMapper];
                        nextKeyMapper.splice(-1, 1);
                        return {
                          keyMapper: nextKeyMapper
                        }
                      })
                    }}>减少最后一个 keyMapper</span>
                    <span className="btn theme mr10" onClick={e => {
                      setState(({ keyMapper }) => {
                        let nextKeyMapper = [...keyMapper, {
                          key: 'len' + keyMapper.length
                        }];
                        return {
                          keyMapper: nextKeyMapper
                        }
                      })
                    }}>增加一个 keyMapper</span>
                    <span className="btn green mr10" onClick={e => {
                      setState(({ records }) => {
                        let nextKeyMapper = [...records, records[0]];
                        return {
                          records: nextKeyMapper
                        }
                      })
                    }}>增加一条记录</span>
                  <Table
                    keyMapper={state.keyMapper}
                    ref={e => table = e}
                    whenCheckAction={(
                      <span className="btn theme mu10" onClick={e => table.clearCheckeds()}>
                        清除所有的以选中项
                      </span>
                    )}
                    rowKey={record => record.id}
                    height={200}
                    needCheck
                    needCount
                    onChange={(emitVal, config) => {
                      console.log(emitVal, config)
                    }}
                    records={state.records} />
                </div>
              )
            }
          }
        </State>
      )
    }
  }
</Playground>

## Toggle 表格的显示，以及重新渲染

<Playground>
  {
    () => {
      return (
        <State initial={{
          keyMapper: [...keyMapperFixed],
          records: [],
          show: false
        }}>
          {
            ({ state, setState }) => {
              let table;

              return (
                <div>
                  <div className="mb10">
                    <span className="btn green mr10" onClick={e => {
                      setState(({ show }) => {
                        const nextShow = !show;
                        return {
                          show: nextShow,
                          records: nextShow ? [...records] : []
                        }
                      })
                    }}>{state.show ? '隐藏' : '显示'}表格</span>
                  </div>
                  <div style={!state.show ? {display: 'none'} : null}>
                    <Table
                      keyMapper={state.keyMapper}
                      ref={e => table = e}
                      whenCheckAction={(
                        <span className="btn theme mu10" onClick={e => table.clearCheckeds()}>
                          清除所有的以选中项
                        </span>
                      )}
                      rowKey={record => record.id}
                      height={200}
                      needCheck
                      needCount
                      onChange={(emitVal, config) => {
                        console.log(emitVal, config)
                      }}
                      records={state.records} />
                  </div>
                </div>
              )
            }
          }
        </State>
      )
    }
  }
</Playground>

<KeyMapper />